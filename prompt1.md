# Chat HistÃ³ria - Sistema de Agendamentos

## Resumo do Projeto
Sistema de agendamentos mÃ©dicos desenvolvido com Nuxt 4, Supabase e TypeScript, incluindo gestÃ£o de profissionais, especialidades e autenticaÃ§Ã£o.

## Principais ImplementaÃ§Ãµes

### 1. Estrutura Base do Projeto
- **Framework**: Nuxt 4 com TypeScript
- **Database**: Supabase com RLS (Row Level Security)
- **Estado**: Pinia para gerenciamento de estado
- **UI**: Tailwind CSS com componentes reutilizÃ¡veis
- **AutenticaÃ§Ã£o**: Supabase Auth com PKCE

### 2. Componentes Base Criados
- `BaseButton.vue` - BotÃ£o reutilizÃ¡vel com variantes
- `BaseInput.vue` - Input com suporte a senha (olhinho)
- `BaseModal.vue` - Modal base com props customizÃ¡veis
- `ModalConfirmacao.vue` - Modal para confirmaÃ§Ãµes
- `ModalEspecialidade.vue` - Modal para CRUD de especialidades
- `ModalProfissional.vue` - Modal para CRUD de profissionais
- `TabelaEspecialidades.vue` - Tabela para listar especialidades
- `TabelaProfissionais.vue` - Tabela para listar profissionais
- `Sidebar.vue` - Menu lateral colapsÃ¡vel
- `DropdownMenu.vue` - Menu dropdown
- `LoginForm.vue` - FormulÃ¡rio de login

### 3. Sistema de AutenticaÃ§Ã£o
- Login com email/senha via Supabase
- Redirecionamento automÃ¡tico apÃ³s login
- ProteÃ§Ã£o de rotas baseada em roles
- Store do usuÃ¡rio com Pinia
- Middleware de autenticaÃ§Ã£o

### 4. Estrutura do Banco de Dados

#### Tabelas Principais:
```sql
-- Perfis de usuÃ¡rios
create table public.ag_profiles (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  user_id uuid null,
  nome text null,
  role text null default 'user'::text,
  constraint ag_profiles_pkey primary key (id),
  constraint ag_profiles_user_id_fkey foreign KEY (user_id) references auth.users (id) on delete CASCADE
);

-- Especialidades mÃ©dicas
create table public.ag_especialidades (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  nome_espec text null,
  constraint ag_especialidades_pkey primary key (id)
);

-- Profissionais
create table public.ag_profissionais (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  profile_id bigint null,
  especialidade_id bigint null,
  constraint ag_profissionais_pkey primary key (id),
  constraint ag_profissionais_especialidade_id_fkey foreign KEY (especialidade_id) references ag_especialidades (id) on delete CASCADE,
  constraint ag_profissionais_profile_id_fkey foreign KEY (profile_id) references ag_profiles (id) on delete CASCADE
);
```

#### View para Profissionais:
```sql
create or replace view public.ag_view_profissionais
with (security_invoker)
as
select
  pr.id as profissional_id,
  pr.profile_id,
  pr.especialidade_id,
  pf.nome as nome_profissional,
  es.nome_espec as especialidade_profissional
from
  public.ag_profissionais pr
  join public.ag_profiles pf on pf.id = pr.profile_id
  join public.ag_especialidades es on es.id = pr.especialidade_id;
```

### 5. FunÃ§Ãµes RPC (Stored Procedures)

#### Especialidades:
```sql
-- Inserir especialidade (admin only)
create or replace function public.ag_add_especialidade(p_nome text)
returns json
language plpgsql
security definer

-- Atualizar especialidade (admin only)
create or replace function public.ag_update_especialidade(p_id bigint, p_nome text)
returns json
language plpgsql
security definer

-- Buscar profissionais (admin only)
create or replace function public.ag_get_profissionais()
returns setof public.ag_view_profissionais
language sql
security definer

-- Buscar perfis (admin only)
create or replace function public.ag_get_profiles_if_admin()
returns table(id bigint, nome text)
language sql
security definer
```

### 6. Composables Criados

#### `useAuth.ts`
- Login/logout via Supabase
- Redirecionamento automÃ¡tico
- Gerenciamento de sessÃ£o

#### `useProfissionais.ts`
- `buscarPerfis()` - Lista perfis para dropdown
- `buscarProfissionais()` - Lista profissionais
- `buscarEspecialidades()` - Lista especialidades
- `inserirProfissional()` - Adiciona profissional
- `editarProfissional()` - Atualiza profissional
- `deletarProfissional()` - Remove profissional
- `inserirEspecialidade()` - Adiciona especialidade
- `editarEspecialidade()` - Atualiza especialidade
- `deletarEspecialidade()` - Remove especialidade

#### `useNotification.ts`
- Sistema de toast notifications
- Feedback visual para aÃ§Ãµes

### 7. Tipos TypeScript (`shared/types/database.ts`)
```typescript
export interface UserProfile {
  id: number
  created_at: string
  user_id: string | null
  nome: string | null
  role: string | null
}

export interface Especialidade {
  id: number
  nome: string
}

export interface Profissional {
  profissional_id: number
  profile_id: number
  especialidade_id: number
  nome_profissional: string
  especialidade_profissional: string
}

export interface Perfil {
  id: number
  nome: string
}
```

### 8. Sistema de PermissÃµes
- **Admin**: Acesso total (CRUD em todas as entidades)
- **User**: Acesso limitado (apenas visualizaÃ§Ã£o)
- Controle via campo `role` na tabela `ag_profiles`
- BotÃµes e aÃ§Ãµes desabilitados para nÃ£o-admin
- PolÃ­ticas RLS no Supabase

### 9. PÃ¡ginas Implementadas
- `/login` - PÃ¡gina de autenticaÃ§Ã£o
- `/confirm` - ConfirmaÃ§Ã£o de email
- `/` - Dashboard (index)
- `/especialidades` - GestÃ£o de especialidades
- `/profissionais` - GestÃ£o de profissionais
- `/clientes` - Em desenvolvimento
- `/agendamentos` - Em desenvolvimento

### 10. Sistema de Design
- **Cores por AÃ§Ã£o**:
  - ðŸ”µ Azul (`primary`) â†’ Criar/Adicionar
  - ðŸŸ¢ Verde (`success`) â†’ Editar/Atualizar
  - ðŸ”´ Vermelho (`error`) â†’ Deletar/Remover
- **Componentes Consistentes**: BotÃµes, inputs, modais
- **Layout Responsivo**: Sidebar colapsÃ¡vel
- **Feedback Visual**: Toast notifications

### 11. Funcionalidades CRUD Completas

#### Especialidades:
- âœ… Listar especialidades
- âœ… Adicionar especialidade (admin)
- âœ… Editar especialidade (admin)
- âœ… Deletar especialidade (admin)
- âœ… Modal de confirmaÃ§Ã£o para exclusÃ£o

#### Profissionais:
- âœ… Listar profissionais
- âœ… Adicionar profissional (admin)
- âœ… Editar profissional (admin)
- âœ… Deletar profissional (admin)
- âœ… Dropdowns para perfil e especialidade
- âœ… Modal de confirmaÃ§Ã£o para exclusÃ£o

### 12. Melhorias de UX Implementadas
- **Loading States**: Indicadores visuais durante operaÃ§Ãµes
- **Error Handling**: Tratamento de erros com feedback
- **ValidaÃ§Ã£o**: Campos obrigatÃ³rios e validaÃ§Ã£o cliente
- **Toast Notifications**: Feedback imediato para aÃ§Ãµes
- **Modal de ConfirmaÃ§Ã£o**: PrevenÃ§Ã£o de exclusÃµes acidentais
- **Cores SemÃ¢nticas**: BotÃµes coloridos por tipo de aÃ§Ã£o
- **Controle de Acesso**: Interface adaptada por role

### 13. Estrutura de Arquivos Final
```
app/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ BaseButton.vue
â”‚   â”œâ”€â”€ BaseInput.vue
â”‚   â”œâ”€â”€ BaseModal.vue
â”‚   â”œâ”€â”€ DropdownMenu.vue
â”‚   â”œâ”€â”€ LoginForm.vue
â”‚   â”œâ”€â”€ ModalConfirmacao.vue
â”‚   â”œâ”€â”€ ModalEspecialidade.vue
â”‚   â”œâ”€â”€ ModalProfissional.vue
â”‚   â”œâ”€â”€ Sidebar.vue
â”‚   â”œâ”€â”€ TabelaEspecialidades.vue
â”‚   â””â”€â”€ TabelaProfissionais.vue
â”œâ”€â”€ composables/
â”‚   â”œâ”€â”€ useAuth.ts
â”‚   â”œâ”€â”€ useNotification.ts
â”‚   â””â”€â”€ useProfissionais.ts
â”œâ”€â”€ layouts/
â”‚   â””â”€â”€ default.vue
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ agendamentos.vue
â”‚   â”œâ”€â”€ clientes.vue
â”‚   â”œâ”€â”€ confirm.vue
â”‚   â”œâ”€â”€ especialidades.vue
â”‚   â”œâ”€â”€ index.vue
â”‚   â”œâ”€â”€ login.vue
â”‚   â”œâ”€â”€ profissionais.vue
â”‚   â””â”€â”€ teste.vue
â”œâ”€â”€ plugins/
â”‚   â”œâ”€â”€ toast.client.ts
â”‚   â””â”€â”€ user-store.client.ts
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ user.ts
â””â”€â”€ app.vue

shared/
â””â”€â”€ types/
    â””â”€â”€ database.ts
```

### 14. ConfiguraÃ§Ãµes do Projeto
- `nuxt.config.ts` - ConfiguraÃ§Ã£o do Nuxt com mÃ³dulos
- `tailwind.config.ts` - Sistema de design customizado
- `.env` - VariÃ¡veis do Supabase
- `package.json` - DependÃªncias do projeto

### 15. PrÃ³ximos Passos Sugeridos
1. **Clientes**: Implementar CRUD de clientes
2. **Agendamentos**: Sistema de agendamento
3. **CalendÃ¡rio**: Interface visual para agendamentos
4. **RelatÃ³rios**: Dashboard com mÃ©tricas
5. **NotificaÃ§Ãµes**: Sistema de lembretes
6. **Backup**: EstratÃ©gia de backup dos dados

## ConclusÃ£o
Sistema robusto de agendamentos com:
- Arquitetura escalÃ¡vel (Nuxt 4 + Supabase)
- SeguranÃ§a implementada (RLS + Auth)
- UX otimizada (componentes reutilizÃ¡veis + feedback visual)
- CÃ³digo tipado (TypeScript em todo projeto)
- Controle de acesso granular (roles + permissions)

O projeto estÃ¡ preparado para expansÃ£o e implementaÃ§Ã£o de novas funcionalidades.